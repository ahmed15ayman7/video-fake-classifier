name: Deploy FastAPI to Hugging Face Spaces

on:
  push:
    branches:
      - main  # ØªØ´ØºÙŠÙ„ Ø§Ù„Ù€ Action Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø¹Ù„Ù‰ Ø§Ù„ÙØ±Ø¹ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ“¥ Clone Repository
        uses: actions/checkout@v3
        with:
          fetch-depth: 0  # Ø§Ø³ØªÙ†Ø³Ø§Ø® Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ (ØªØ¬Ù†Ø¨ Ù…Ø´Ø§ÙƒÙ„ shallow clone)

      - name: ğŸ”§ Setup Python
        uses: actions/setup-python@v3
        with:
          python-version: "3.10"

      - name: ğŸ“¦ Install Dependencies
        run: pip install -r requirements.txt

      - name: ğŸš€ Deploy to Hugging Face Spaces
        env:
          HF_TOKEN: ${{ secrets.HF_TOKEN }}
        run: |
          git config --global user.email "ahmed15ayman7ayman2002@gmail.com"
          git config --global user.name "ahmed15ayman7"
          
          # Ø¥Ø²Ø§Ù„Ø© Ù…Ø´Ø§ÙƒÙ„ LFS Ø¥Ø°Ø§ Ù„Ù… ØªÙƒÙ† Ù…Ø³ØªØ®Ø¯Ù…Ø©
          git lfs uninstall || true
          
          # Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· `origin` Ù„Ø¶Ù…Ø§Ù† Ø§Ù„Ø§ØªØµØ§Ù„ Ø§Ù„ØµØ­ÙŠØ­
          git remote set-url origin https://ahmed-mac:${HF_TOKEN}@huggingface.co/spaces/ahmed15ayman7/video-fake-classifier

          # Ø¬Ù„Ø¨ Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª Ù…Ù† Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹ Ù„ØªØ¬Ù†Ø¨ Ø£ÙŠ ØªØ¹Ø§Ø±Ø¶
          git pull origin main --rebase

          # Ø¥Ø¶Ø§ÙØ© Ø£ÙŠ ØªØºÙŠÙŠØ±Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©
          git add .
          git commit --allow-empty -m "ğŸš€ Force redeploy FastAPI"

          # ÙØ±Ø¶ Ø§Ù„Ø¯ÙØ¹ Ø­ØªÙ‰ Ù„Ùˆ Ù„Ù… ÙŠÙƒÙ† Ù‡Ù†Ø§Ùƒ ØªØºÙŠÙŠØ±Ø§Øª ÙƒØ¨ÙŠØ±Ø©
          git push --force origin main
